<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
  <title>設定ファイル</title>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/redmond/jquery-ui.css" >
  <?!= HtmlService.createHtmlOutputFromFile('css').getContent(); ?>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <h1 id="dailylog">
          <span>設定</span>
          <button class="btn btn-default location" onclick="window.top.location.href='<?= url ?>'">日報</button>
        </h1>
      </div>
    </div>
  </nav>

  <div class="mainpanel">
    <table class="table table-striped mail-contents">
      <thead>
      </thead>
      <tbody>
        <tr>
          <td>
            <span>名字</span>
            <input class="name1" value="<?= name1; ?>">
          </td>
        </tr> 
        <tr>
          <td>
            <span>名前</span>
            <input class="name2" value="<?= name2; ?>">
          </td>
        </tr>
        <tr>
          <td>
            <div>from</div>
            <textarea class="from"><?= from; ?></textarea>
          </td>
        </tr>
        <tr>
          <td>
            <div>to</div>
            <textarea class="to"><?= to; ?></textarea>
          </td>
        </tr>   
        <tr>
          <td>
            <div>cc</div>
            <textarea class="cc"><?= cc; ?></textarea>
          </td>
        </tr>   
        <tr>
          <td>稼働時間デフォルト</td>
        </tr>
        <tr>
          <td class="work-time">
            <select class="btn btn-lg btn-default start hour dropdown">
<? for (var i = 0; i < 24; i++){ ?>
<? var p = (i < 10) ? ('0' + i) : i; ?>
              <option value="<?= i ?>"><?= p ?></option>
<? } ?>
            </select>:
            <select class="btn btn-lg btn-default start minute dropdown">
              <option value="0">00</option>
              <option value="15">15</option>
              <option value="30">30</option>
              <option value="45">45</option>
            </select>
            <input type="hidden" name="start" value="<?= JSON.stringify(start); ?>">
            <span>&nbsp;～&nbsp;</span>
            <select class="btn btn-lg btn-default end hour dropdown">
<? for (var i = 0; i < 30; i++) { ?>
<? var p = (i < 10) ? ('0' + i) : i; ?>
              <option value="<?= i ?>"><?= p ?></option>
<? } ?>
            </select>:
            <select class="btn btn-lg btn-default end minute dropdown">
              <option value="0">00</option>
              <option value="15">15</option>
              <option value="30">30</option>
              <option value="45">45</option>
            </select>
            <input type="hidden" name="end" value="<?= JSON.stringify(end); ?>">
          </td>
        </tr>      
        <tr>
          <td>
            <span>休憩時間デフォルト</span>
            <select class="btn btn-lg btn-default break-time dropdown">
<? for (var i = 0; i <= 40; i++) { ?>
<? var t = i * 15; ?>
              <option value="<?= t ?>"><?= t ?></option>
<? } ?>
            </select>
            <span>分</span>
            <input type="hidden" name="break-time" value="<?= breakTime; ?>">
          <td>
        </tr> 
        <tr>
          <td class="add-body"><span>最初の文</span><td>
        </tr>             
        <tr>
          <td><textarea class="jobun"><?= jobun; ?></textarea></td>      
        <tr>
          <td class="add-body"><span>署名</span><td>
        </tr>             
        <tr>
          <td><textarea class="signature"><?= signature; ?></textarea></td>
        </tr>
      </tbody>
    </table>
    <table class="table table-striped">
      <thead>
      </thead>
      <tbody>
        <tr>
          <td><button class="send btn-lg" id="save">保存</button><br /></td>
        </tr>
      </tbody>
    </table>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1/i18n/jquery.ui.datepicker-ja.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script>
  $(function() {
    $(window).load(function() {
      if ($(window).height() / $(window).width() < 1) {
        $('body').css('font-size', '1.5em');
        $('textarea.jobun').css('height', '200px');
        $('textarea.signature').css('height', '300px');
        $('textarea.honbun, textarea.kiroku, textarea.goal').css('height', '100px');
        $('textarea.work-time-weekly').css('height', '170px');
        $('.btn-group-lg>.btn, .btn-lg').css('padding', '2px 4px');
      } else {
        $('table.mail-contents tbody tr td').css('padding', '30px');
        $('textarea.jobun').css('height', '500px');
        $('textarea.signature').css('height', '600px');
      }
    });
      var start = JSON.parse($('input[name="start"]').val());    
      var end = JSON.parse($('input[name="end"]').val());
      $('.start.hour').find('option[value="' + start[0] + '"]').prop('selected', true);
    
      $('.start.minute').find('option[value="' + start[1] + '"]').prop('selected', true);
      $('.end.hour').find('option[value="' + end[0] + '"]').prop('selected', true);
      $('.end.minute').find('option[value="' + end[1] + '"]').prop('selected', true);
      $('.break-time').find('option[value="' + $('input[name="break-time"]').val() + '"]').prop('selected', true);
          
    $(document).on('click', '#save', function() {
      var data = {
        name1: $('.name1').val(),
        name2: $('.name2').val(),
        to: $('.to').val(),
        from: $('.from').val(),
        cc: $('.cc').val(),
        start: getTime('start'),
        end: getTime('end'),
        breakTime: $('.break-time').val(),
        jobun: $('textarea.jobun').val(),
        signature: $('textarea.signature').val(),
      };
      if (confirm('保存しますか？')) {
        google.script.run.withSuccessHandler(function(result) {
          alert('保存しました');
        }).saveConfig(data);
      }
    });
     
    function getTime(type) {
      if (type == 'start') {
        return ('0' + $('.start.hour').val()).slice(-2) + ':' + ('0' + $('.start.minute').val()).slice(-2);
      } else if (type == 'end') {
        return ('0' + $('.end.hour').val()).slice(-2) + ':' + ('0' + $('.end.minute').val()).slice(-2);
      }
      return null;
    }
  });
  </script>
  </body>
</html>
